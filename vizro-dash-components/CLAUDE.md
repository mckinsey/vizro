# CLAUDE.md for `vizro-dash-components` folder

`vizro-dash-components` is a custom Dash component library that can be used in any Dash app.

## Development

### Working Directory

**Important**: All Hatch commands must be run from the `vizro-dash-components/` directory.

### Prerequisites

- Node.js and npm (for building JS/CSS assets)
- Hatch (Python project manager)
- Run `hatch run npm:install` once after cloning

### Hatch commands

#### npm (JS/CSS build)

- `hatch run npm:build` - Full build: compile JS/CSS via webpack + generate Python component classes via `dash-generate-components`
- `hatch run npm:lint` - Lint JS/TS source with Biome
- `hatch run npm:fmt` - Auto-fix JS/TS formatting with Biome

**Source of truth**: Only edit TypeScript/JS files in `src/ts/`. Never directly edit auto-generated files in `vizro_dash_components/` — Python bindings (`*.py`) are regenerated by `dash-generate-components` and the JS bundle (`*.js`) is regenerated by webpack. After editing source files, always run `hatch run npm:build` to regenerate.

**Troubleshooting**:

- `npm run build` requires Python — the build is a hybrid process. `build:js` is pure webpack, but `build:backends` calls `dash-generate-components` which is a Python CLI tool. Python with `dash[dev]` must be available on PATH.
- `dash-generate-components` is NOT a separate package. It is included in `dash[dev]`. The hatch `npm` env is detached (no managed Python deps), so `dash[dev]` must be available on PATH independently.

#### Python

- `hatch run lint` - Run pre-commit linters on all files
- `hatch run example` - Run the usage.py example app on port 8050

#### Changelog

- `hatch run changelog:add` - Create a changelog fragment (required for PRs)

### Project structure

- `src/ts/components/` - Dash component definitions (TypeScript/React). Each file here becomes a Python Dash component
- `src/ts/fragments/` - Internal React components used by the Dash components (not exported as Dash components)
- `vizro_dash_components/` - Auto-generated Python package (built artifacts, do not edit manually)
- `usage.py` - Standalone Dash example app for testing components outside Vizro
- `pyproject.toml` - Python package configuration (version sourced from `package.json` via `hatch-nodejs-version`)
- `package.json` - npm package configuration with build scripts
- `hatch.toml` - Hatch environment and script configuration
- `webpack.config.js` - Webpack config. Auto-derives the Python package name from `package.json` name via `.replace(/-/g, "_")`
- `MANIFEST.in` - Controls files included in Python sdist

### Writing Dash components

Each `.tsx` file in `src/ts/components/` becomes a Dash component. Key patterns:

- Extend `DashComponentProps` for the required `id` and `setProps` props
- Call `setProps({prop: newValue})` to trigger Dash callbacks
- JSDoc comments on the component and its props become Python docstrings
- `defaultProps` on the component set Python default values

## Testing with vizro-core

To test `vizro-dash-components` local changes in `vizro-core`:

1. Build the component: `hatch run npm:build` (from `vizro-dash-components/`)
1. Install into vizro-core's hatch env:
    ```bash
    # From vizro-core/, find the env's Python path:
    hatch run examples:pypath
    # Then install editable:
    uv pip install -e ../vizro-dash-components --python "<path from above>"
    ```
1. Add the component under test to `vizro-core/examples/scratch_dev/app.py`
1. Run the vizro-core example: `hatch run example` (from `vizro-core/`)
